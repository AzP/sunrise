diff -ru mugshot-1.1.32.orig/configure.ac mugshot-1.1.32/configure.ac
--- mugshot-1.1.32.orig/configure.ac	2007-02-01 19:09:36.000000000 -0500
+++ mugshot-1.1.32/configure.ac	2007-02-02 15:28:19.800967622 -0500
@@ -369,6 +369,8 @@
 
 have_full_gecko=false
 sdk_includes_nspr=false
+sdk_includes_xpcom_core=false
+sdk_includes_xpcom=false
 
 if test "x$with_gecko_sdk" != x -a "x$with_gecko_sdk" != xyes -a "x$with_gecko_sdk" != xno ; then
    GECKO_IDLDIR="$with_gecko_sdk/idl"
@@ -378,6 +380,14 @@
    if test -f "$GECKO_INCLUDEDIR/nspr.h" ; then
        sdk_includes_nspr=true
    fi
+
+   if test -f "$with_gecko_sdk/lib/libxpcom.so" ; then
+       sdk_includes_xpcom=true
+       if test -f "$with_gecko_sdk/lib/libxpcom_core.so" ; then
+           sdk_includes_xpcom_core=true
+       fi
+   fi
+
 fi
 
 if test "x$with_gecko_idl" != x -a "x$with_gecko_idl" != xyes -a "x$with_gecko_idl" != xno ; then
@@ -486,12 +496,29 @@
     fi
 fi
 
-PKG_CHECK_MODULES(LIBHIPPOFIREFOX, gobject-2.0 dbus-1 >= $DBUS_REQUIRED dbus-glib-1 >= $DBUS_REQUIRED $NSPR_PACKAGES gtk+-2.0)
+if $sdk_includes_xpcom ; then
+    if $sdk_includes_xpcom_core ; then
+        XPCOM_LIBS="-L $with_gecko_sdk/lib -xpcom_core"
+    else
+        XPCOM_LIBS="-L $with_gecko_sdk/lib -lxpcom"
+    fi
+else
+    for pkg in firefox-xpcom xpcom ; do
+        if test "x$XPCOM_PACKAGES" = x ; then
+            PKG_CHECK_EXISTS($pkg, XPCOM_PACKAGES=$pkg)
+        fi
+    done
+    if test "x$XPCOM_PACKAGES" = x ; then
+        AC_MSG_ERROR([Can't find xpcom])
+    fi
+fi
+
+PKG_CHECK_MODULES(LIBHIPPOFIREFOX, gobject-2.0 dbus-1 >= $DBUS_REQUIRED dbus-glib-1 >= $DBUS_REQUIRED $NSPR_PACKAGES $XPCOM_PACKAGES gtk+-2.0)
 
 # Should have -lxpcom here, but that upsets libtool for unknown reasons. Or
 # should we use -lxpcomglue instead? We don't actually link to anything private, though
 # we use some private interfaces
-LIBHIPPOFIREFOX_LIBS="$LIBHIPPOFIREFOX_LIBS $NSPR_LIBS"
+LIBHIPPOFIREFOX_LIBS="$LIBHIPPOFIREFOX_LIBS $NSPR_LIBS $XPCOM_LIBS"
 
 #### define absolute path to srcdir for debugging-only code
 ABSOLUTE_TOP_SRCDIR=`cd ${srcdir} && pwd`
