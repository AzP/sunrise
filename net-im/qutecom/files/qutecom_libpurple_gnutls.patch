
# HG changeset patch
# User ludovico.cavedon@gmail.com
# Date 1237671131 25200
# Node ID 2260663e58c478857668073be3b571e9fe96b375
# Parent 2a9fda06d182b39f9ca5f2ddf9be102226114272
Accept SSL certificate with wrong hostname

--- a/libs/imwrapper/src/purple/PurpleIMFactory.cpp	Sat Mar 21 14:27:28 2009 -0700
+++ b/libs/imwrapper/src/purple/PurpleIMFactory.cpp	Sat Mar 21 14:32:11 2009 -0700
@@ -140,6 +140,19 @@
 	return closure->result;
 }
 
+static void* purple_wg_request_action(const char *title, const char *primary,
+		const char *secondary, int default_action,
+		PurpleAccount *account, const char *who,
+		PurpleConversation *conv, void *user_data, size_t action_count,
+		va_list actions) {
+	const char *text = va_arg(actions, const char *);
+	PurpleRequestActionCb callback = va_arg(actions, PurpleRequestActionCb);
+
+	LOG_WARN("requested action: %s: %s, %s. Default action: %s", title, primary, secondary, text);
+	callback(user_data, 0);
+        return NULL;
+}
+
 gpointer PurpleMainEventLoop(gpointer data) {
 	if (gMainLoop) {
 		LOG_FATAL("gMainLoop already created");
@@ -170,6 +183,19 @@
 	g_source_remove,
 	purple_wg_input_add,
 	g_source_remove
+};
+
+static PurpleRequestUiOps request_wg_ops = {
+	NULL,
+	NULL,
+	purple_wg_request_action,
+	NULL,
+	NULL,
+	NULL,
+	NULL,
+	NULL,
+	NULL,
+	NULL
 };
 
 bool PurpleIMFactory::equals(const IMAccount & imAccount, std::string login, EnumIMProtocol::IMProtocol protocol) {
@@ -236,6 +262,8 @@
 	purple_plugins_add_search_path("plugins");
 	g_free(search_path);
 
+	purple_request_set_ui_ops(&request_wg_ops);
+
 	if (!purple_core_init("Wengo PURPLE")) {
 		LOG_WARN("Initialization of the Purple core failed\n");
 	}

